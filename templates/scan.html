{% extends "layout.html" %}

{% block title %}
    Escanear Boleto
{% endblock %}

{% block content %}    

<!-- QR Code Scanner made with the help of AI-->
<div class="d-flex flex-column align-items-center justify-content-center">
    <h1>Escanea tu boleto</h1>
    <div id="reader" style="width: 400px"></div>
    <div id="result" class="mt-3 text-center"></div>
</div>
<script src="https://unpkg.com/html5-qrcode"></script>
<script>
    function onScanSuccess(decodedText, decodedResult) {
        fetch(`/validate_ticket?ticket_id=${decodedText}`)
            .then(res => res.json())
            .then(data => {
                const resultDiv = document.getElementById("result");
                if (data.success) {
                    resultDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                }
            });
        html5QrcodeScanner.clear(); 
    }

    const html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
    html5QrcodeScanner.render(onScanSuccess);
</script>
{% endblock %}